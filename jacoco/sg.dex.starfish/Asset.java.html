<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Asset.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Starfish - client library for data ecosystems</a> &gt; <a href="index.source.html" class="el_package">sg.dex.starfish</a> &gt; <span class="el_source">Asset.java</span></div><h1>Asset.java</h1><pre class="source lang-java linenums">package sg.dex.starfish;

import sg.dex.starfish.constant.Constant;
import sg.dex.starfish.exception.AuthorizationException;
import sg.dex.starfish.exception.StorageException;
import sg.dex.starfish.util.DID;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.Map;

/**
 * Interface representing an Asset. An Asset in Starfish is an entity in the
 * decentralised data ecosystem
 * that is:
 * A) Described by metadata
 * B) Able to be used in Digital Supply Lines
 *
 * @author Mike
 * @version 0.5
 */
public interface Asset {

    /**
     * Gets the ID for this Asset.
     * &lt;p&gt;
     * The format of the asset ID is determined by the implementation.
     *
     * @return the assetID
     * @throws UnsupportedOperationException if unable to obtain ID
     */
    String getAssetID();

    /**
     * Gets the  DID for this asset. The DID may include a DID path to specify
     * the precise asset if the DID refers to an agent managing the asset.
     * Throws an exception if a DID is not available or cannot be constructed.
     *
     * @return The global DID for this asset.
     * @see &lt;a href=&quot;https://w3c-ccg.github.io/did-spec&quot;&gt;W3C DID spec&lt;/a&gt;
     */
    DID getDID();

    /**
     * Gets a copy of the JSON metadata for this asset, as a map of strings to
     * values.
     * &lt;p&gt;
     * Asset metadata will differ as per type of asset: (e.g. dataset,
     * operation, bundle)
     *
     * @return New clone of the parsed JSON metadata for this asset
     */
    Map&lt;String, Object&gt; getMetadata();

    /**
     * Returns true if this asset is a data asset, i.e. the asset represents an
     * immutable
     * data object.
     *
     * @return true if the asset is a data asset, false otherwise
     */
    default boolean isDataAsset() {
<span class="nc" id="L64">        return Constant.DATA_SET.equals(getMetadata().get(Constant.TYPE));</span>
    }

    /**
     * Returns true if this asset is an operation, i.e. can be invoked on an
     * appropriate agent
     *
     * @return true if this asset is an operation, false otherwise
     */
    default boolean isOperation() {
<span class="nc" id="L74">        return Constant.OPERATION.equals(getMetadata().get(Constant.TYPE));</span>
    }

    /**
     * Returns the metadata for this asset as a String. Assets should store
     * their metadata by default
     * as a valid JSON string.
     * &lt;p&gt;
     * Warning: Some implementations may not validate the JSON on asset creation
     * and it is possible
     * for the metadata String to contain invalid JSON.
     *
     * @return The metadata of this asset as a String
     */
    String getMetadataString();

    /**
     * Gets the contents of this data asset as a byte[] array.
     *
     * @return The byte contents of this asset.
     * @throws UnsupportedOperationException If this asset does not support
     *                                       getting byte data
     * @throws AuthorizationException        if requester does not have access
     *                                       permission
     * @throws StorageException              if unable to load the Asset
     */
    default byte[] getContent() {
<span class="fc" id="L101">        InputStream is = getContentStream();</span>
<span class="fc" id="L102">        ByteArrayOutputStream buffer = new ByteArrayOutputStream();</span>

<span class="fc" id="L104">        byte[] buf = new byte[16384];</span>

        int bytesRead;
        try {
<span class="fc bfc" id="L108" title="All 2 branches covered.">            while ((bytesRead = is.read(buf, 0, buf.length)) != -1) {</span>
<span class="fc" id="L109">                buffer.write(buf, 0, bytesRead);</span>
            }
<span class="nc" id="L111">        } catch (IOException e) {</span>
<span class="nc" id="L112">            throw new StorageException(&quot;Unable to get Asset content&quot;, e);</span>
<span class="fc" id="L113">        }</span>
<span class="fc" id="L114">        return buffer.toByteArray();</span>
    }

    /**
     * Gets the contents of this data asset as a input stream.
     *
     * @return The byte contents of this asset.
     * @throws UnsupportedOperationException If this asset does not support
     *                                       getting byte data
     * @throws AuthorizationException        if requester does not have access
     *                                       permission
     * @throws StorageException              if unable to load the Asset
     */
    default InputStream getContentStream() {
<span class="nc" id="L128">        throw new UnsupportedOperationException(&quot;Cannot get InputStream for asset of class: &quot; + this.getClass().getCanonicalName());</span>
    }

    /**
     * Gets the representation of this asset as required to pass to a remote
     * invokable
     * service.
     *
     * @return A map representing this asset
     */
    Map&lt;String, Object&gt; getParamValue();

    /**
     * Tests if this asset is an bundle, i.e. can contain sub-assets.
     *
     * @return true if this asset is an bundle, false otherwise
     */
    default boolean isBundle() {
<span class="nc" id="L146">        return Constant.BUNDLE.equals(getMetadata().get(Constant.TYPE));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>