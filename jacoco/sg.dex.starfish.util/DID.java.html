<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DID.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Starfish - client library for data ecosystems</a> &gt; <a href="index.source.html" class="el_package">sg.dex.starfish.util</a> &gt; <span class="el_source">DID.java</span></div><h1>DID.java</h1><pre class="source lang-java linenums">package sg.dex.starfish.util;

import sg.dex.starfish.constant.Constant;

import java.security.SecureRandom;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Class representing a valid W3C DID
 * See: https://w3c-ccg.github.io/did-spec/
 *
 * @author Mike
 */
public class DID {
    private static final String METHOD_REGEX = &quot;([a-z]+)&quot;;
    private static final String ID_REGEX = &quot;([a-fA-F0-9]{1,64})?&quot;;
    private static final String PATH_REGEX = &quot;(?:/([a-z0-9\\-._~%!$&amp;'()*+,;=:@/]*))?&quot;;
    private static final String FRAGMENT_REGEX = &quot;(?:#(.*))?&quot;;
<span class="fc" id="L20">    private static final Pattern DID_PATTERN = Pattern.compile(&quot;did:&quot; + METHOD_REGEX + &quot;:&quot; + ID_REGEX + PATH_REGEX + FRAGMENT_REGEX + &quot;$&quot;);</span>

    private final String method;
    private final String id;
    private final String path;
    private final String fragment;
<span class="fc" id="L26">    private String fullString = null;</span>

    /**
     * Creates a DID
     *
     * @param method   METHOD portion of DID
     * @param id       ID portion of DID
     * @param path     PATH portion of DID (optional)
     * @param fragment FRAGMENT portion of DID  (optional)
     * @throws IllegalArgumentException if method or id are null
     */
<span class="fc" id="L37">    private DID(String method, String id, String path, String fragment) {</span>
<span class="pc bpc" id="L38" title="1 of 2 branches missed.">        if (method == null) throw new IllegalArgumentException(&quot;DID method cannot be null&quot;);</span>
<span class="pc bpc" id="L39" title="1 of 2 branches missed.">        if (id == null) throw new IllegalArgumentException(&quot;DID id cannot be null&quot;);</span>
<span class="fc" id="L40">        this.method = method;</span>
<span class="fc" id="L41">        this.id = id;</span>
<span class="fc" id="L42">        this.path = path;</span>
<span class="fc" id="L43">        this.fragment = fragment;</span>
<span class="fc" id="L44">    }</span>

    /**
     * Creates a DID with the specified method, id, path and fragment
     *
     * @param method   The DID method, e.g. &quot;op&quot;
     * @param id       The DID idstring
     * @param path     The DID path
     * @param fragment The DID fragment
     * @return DID The newly created DID
     */
    public static DID create(String method, String id, String path, String fragment) {
<span class="fc" id="L56">        return new DID(method, id, path, fragment);</span>
    }

    /**
     * Checks if the provided String is a valid DID
     *
     * @param did Any String to test as a DID
     * @return boolean true if the String is parseable as a valid DID, false otherwise
     */
    public static boolean isValidDID(String did) {
<span class="nc" id="L66">        Matcher m = DID_PATTERN.matcher(did);</span>
<span class="nc" id="L67">        return m.matches();</span>
    }

    /**
     * Attempts to parse the given string as a DID
     *
     * @param did The String to parse as a DID
     * @return DID The newly created DID
     * @throws IllegalArgumentException on DID parse error
     */
    public static DID parse(String did) {
<span class="fc" id="L78">        Matcher m = DID_PATTERN.matcher(did);</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">        if (m.matches()) {</span>
<span class="fc" id="L80">            String method = m.group(1);</span>
<span class="fc" id="L81">            String id = m.group(2);</span>
<span class="fc" id="L82">            String path = m.group(3);</span>
<span class="fc" id="L83">            String fragment = m.group(4);</span>
<span class="fc" id="L84">            DID newDID = new DID(method, id, path, fragment);</span>
<span class="fc" id="L85">            newDID.fullString = did;</span>
<span class="fc" id="L86">            return newDID;</span>
        } else {
<span class="nc" id="L88">            throw new IllegalArgumentException(&quot;Parse failure on invalid DID [&quot; + did + &quot;]&quot;);</span>
        }
    }

    /**
     * Creates a random DEP-compliant DID as a string, of the format:
     * &lt;p&gt;
     * &quot;did:dep:a1019172af9ae4d6cb32b52193cae1e3d61c0bcf36f0ba1cd30bf82d6e446563&quot;
     *
     * @return A valid DID represented as a string
     */
    public static String createRandomString() {
<span class="fc" id="L100">        SecureRandom sr = new SecureRandom();</span>
<span class="fc" id="L101">        byte[] bytes = new byte[Utils.DID_LENGTH];</span>
<span class="fc" id="L102">        sr.nextBytes(bytes);</span>
<span class="fc" id="L103">        return Constant.DID + &quot;:&quot; + Constant.DID_METHOD + &quot;:&quot; + Hex.toString(bytes);</span>
    }

    /**
     * Creates a random DEP-compliant DID
     *
     * @return The created DID
     */
    public static DID createRandom() {
<span class="fc" id="L112">        return parse(DID.createRandomString());</span>
    }

    /**
     * Gets the DID scheme for this DID
     *
     * @return String The DID scheme, always defined as &quot;did&quot;
     */
    public String getScheme() {
<span class="fc" id="L121">        return &quot;did&quot;;</span>
    }

    /**
     * Gets the DID method for this DID
     *
     * @return String The DID method, e.g. &quot;dep&quot;
     */
    public String getMethod() {
<span class="fc" id="L130">        return method;</span>
    }

    /**
     * Gets the DID idstring for this DID
     *
     * @return String The DID idstring, e.g. &quot;2ee8d7d4dd764bc96e8f1c762b1ca4ff54688b22aeb851378aa9a543290bcbd9&quot;
     */
    public String getID() {
<span class="fc" id="L139">        return id;</span>
    }

    /**
     * Gets the DID path for this DID
     *
     * @return String The DID path, or null if there is no path specified
     */
    public String getPath() {
<span class="fc" id="L148">        return path;</span>
    }

    /**
     * Gets the DID fragment for this DID
     *
     * @return String The DID fragment, or null if there is no fragment specified
     */
    public String getFragment() {
<span class="nc" id="L157">        return fragment;</span>
    }

    private String createString() {
<span class="fc" id="L161">        StringBuffer sb = new StringBuffer();</span>
<span class="fc" id="L162">        sb.append(&quot;did&quot;);</span>
<span class="fc" id="L163">        sb.append(':');</span>
<span class="fc" id="L164">        sb.append(method);</span>
<span class="fc" id="L165">        sb.append(':');</span>
<span class="fc" id="L166">        sb.append(id);</span>
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">        if (path != null) {</span>
<span class="fc" id="L168">            sb.append('/');</span>
<span class="fc" id="L169">            sb.append(path);</span>
        }
<span class="pc bpc" id="L171" title="1 of 2 branches missed.">        if (fragment != null) {</span>
<span class="nc" id="L172">            sb.append('#');</span>
<span class="nc" id="L173">            sb.append(fragment);</span>
        }

<span class="fc" id="L176">        return sb.toString();</span>
    }

    @Override
    public String toString() {
<span class="fc bfc" id="L181" title="All 2 branches covered.">        if (fullString == null) fullString = createString();</span>
<span class="fc" id="L182">        return fullString;</span>
    }

    @Override
    public boolean equals(Object o) {
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">        if (!(o instanceof DID)) return false;</span>
<span class="fc" id="L188">        return equals((DID) o);</span>
    }

    /**
     * Tests if this DID is equal to another DID
     *
     * @param d The DID to compare for equality
     * @return boolean true if this DID equals the DID argument, false otherwise
     */
    public boolean equals(DID d) {
<span class="pc bpc" id="L198" title="1 of 2 branches missed.">        if (!method.equals(d.method)) return false;</span>
<span class="pc bpc" id="L199" title="1 of 2 branches missed.">        if (!id.equals(d.id)) return false;</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">        if (!Utils.equals(path, d.path)) return false;</span>
<span class="fc" id="L201">        return Utils.equals(fragment, d.fragment);</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L206">        int h = 0;</span>
<span class="fc" id="L207">        h += method.hashCode();</span>
<span class="fc" id="L208">        h += 13 * id.hashCode();</span>
<span class="fc" id="L209">        h += 53 * Utils.hashCode(path);</span>
<span class="fc" id="L210">        h += 101 * Utils.hashCode(fragment);</span>
<span class="fc" id="L211">        return h;</span>
    }

    /**
     * Creates a new DID from this DID with an updated path.
     *
     * @param path The new path to add to this DID (may be null)
     * @return DID The updated DID with the specified path argument
     */
    public DID withPath(String path) {
<span class="fc" id="L221">        return DID.create(method, id, path, fragment);</span>
    }

    /**
     * Removes the path and fragment from a DID, creating a simple DID that identifies the DID Subject.
     *
     * @return A DID without path and fragment portions.
     */
    public DID withoutPath() {
<span class="pc bpc" id="L230" title="1 of 4 branches missed.">        if ((path == null) &amp;&amp; (fragment == null)) return this;</span>
<span class="fc" id="L231">        return new DID(method, id, null, null);</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>